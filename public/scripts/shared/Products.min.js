(function(){var t,n;n=angular.module("app.product",["app.services"]);n.controller("ProductsCtrl",["$scope","$filter","ProductModalProvider","ProductService","Auth","ConfirmationProvider","uiHelper",function(n,t,i,r,u,f,e){var s,o;return n.searchKeywords="",n.filteredProducts=[],n.row="",n.select=function(t){var r,i;return i=(t-1)*n.numPerPage,r=i+n.numPerPage,n.currentPageStores=n.filteredProducts.slice(i,r)},n.onFilterChange=function(){return n.select(1),n.currentPage=1,n.row=""},n.onNumPerPageChange=function(){return n.select(1),n.currentPage=1},n.onOrderChange=function(){return n.select(1),n.currentPage=1},n.search=function(){return n.filteredProducts=t("filter")(n.products,n.searchKeywords),n.onFilterChange()},n.order=function(i){if(n.row!==i)return n.row=i,n.filteredProducts=t("orderBy")(n.products,i),n.onOrderChange()},n.numPerPageOpt=[3,5,10,20],n.numPerPage=n.numPerPageOpt[2],n.currentPage=1,n.currentPageStores=[],o=function(){return r.query({venueId:u.getCurrentUser().venue_id},function(t){return n.products=t,s()})},s=function(){return n.search(),n.select(n.currentPage)},o(),n.edit=function(n){return i.Create(n.id).result.then(function(){return o()})},n["delete"]=function(t){return f.Create("Are you sure you want to delete product: "+t.name+"?").result.then(function(){return r["delete"]({id:t.id,venueId:t.venue_id},function(){return o()},function(t){return e.handleApiError(n,t)})})},n.add=function(){return i.Create(0).result.then(function(){return o()})}}]);t=function(n,t,i,r,u,f,e){var o,s;return n.Title="Product Management",s="/v1/venues/"+f.getCurrentUser().venue_id+"/products/upload",o=n.uploader=new r({url:s,headers:{"x-application-id":"com.secret-service.admin","X-Requested-With":"XMLHttpRequest","x-auth-token":f.getCurrentUser().auth_token}}),o.filters.push({name:"imageFilter",fn:function(n){var t;return t="|"+n.type.slice(n.type.lastIndexOf("/")+1)+"|","|png|".indexOf(t)!==-1}}),o.onAfterAddingFile=function(){if(o.queue.length>1)return o.queue.splice(0,1)},o.onWhenAddingFileFailed=function(n){return e.logWarning("Invalid file: "+n.name+". The image must be a png file format.")},u>0?i.get({id:u,venueId:f.getCurrentUser().venue_id},function(t){var i;return n.product=t,i=Date.now()*1e4+621355968000000000,n.imagePath="/images/"+n.product.id+".png?ts="+i}):i["new"]({venueId:f.getCurrentUser().venue_id},function(t){return n.product=t}),n.save=function(){var r;return r=u===0?i.post({venueId:f.getCurrentUser().venue_id},n.product):i.put({id:n.product.id,venueId:f.getCurrentUser().venue_id},n.product),r.$promise.then(function(i){return n.product=i,o.queue.length>0&&(o.queue[0].file.name=i.id+".png",o.queue[0].formData.push({imageName:i.id+".png"}),o.queue[0].upload()),e.showSavedSuccess(),t.close()})["catch"](function(t){return e.handleApiError(n,t)})},n.cancel=function(){return t.dismiss("close")}};n.controller("ProductModalCtrl",["$scope","$modalInstance","ProductService","FileUploader","productId","Auth","uiHelper",function(n,i,r,u,f,e,o){return new t(n,i,r,productId,e,o)}]);n.factory("ProductModalProvider",["$modal",function(n){var i;return i={},i.Create=function(i){return n.open({templateUrl:"/views/products/product-modal.html",controller:t,controllerAs:"ProductModalCtrl",size:"lg",resolve:{productId:function(){return i}}})},i}])}).call(this);
/*
//# sourceMappingURL=Products.min.js.map
*/