(function(){var t,n;n=angular.module("app.user",["app.services"]);n.controller("UsersCtrl",["$scope","$filter","UserModalProvider","UserService","Auth","ConfirmationProvider","uiHelper",function(n,t,i,r,u,f,e){var s,o;return n.searchKeywords="",n.filteredUsers=[],n.row="",n.select=function(t){var r,i;return i=(t-1)*n.numPerPage,r=i+n.numPerPage,n.currentPageStores=n.filteredUsers.slice(i,r)},n.onFilterChange=function(){return n.select(1),n.currentPage=1,n.row=""},n.onNumPerPageChange=function(){return n.select(1),n.currentPage=1},n.onOrderChange=function(){return n.select(1),n.currentPage=1},n.search=function(){return n.filteredUsers=t("filter")(n.users,n.searchKeywords),n.onFilterChange()},n.order=function(i){if(n.row!==i)return n.row=i,n.filteredUsers=t("orderBy")(n.users,i),n.onOrderChange()},n.numPerPageOpt=[3,5,10,20],n.numPerPage=n.numPerPageOpt[2],n.currentPage=1,n.currentPageStores=[],o=function(){var t;return t=null,u.getCurrentUser().role.bitMask&routingConfig.userRoles.venueadmin.bitMask&&(t={role:routingConfig.userRoles.waiter.bitMask|routingConfig.userRoles.venueadmin.bitMask}),u.getCurrentUser().role.bitMask&routingConfig.userRoles.admin.bitMask&&(t={role:routingConfig.userRoles.venueadmin.bitMask|routingConfig.userRoles.admin.bitMask}),r.query(t,function(t){return n.users=t,s()})},s=function(){return n.search(),n.select(n.currentPage)},o(),n.lookupRoleName=function(n){var t;return t=_.find(routingConfig.userRolesArray,function(t){return t.bitMask===n}),t.display},n.edit=function(n){return i.Create(n.id).result.then(function(){return o()})},n["delete"]=function(t){return f.Create("Are you sure you want to delete user: "+t.firstname+" "+t.lastname+"?").result.then(function(){return r["delete"]({id:t.id},function(){return e.showDeletedSuccess(),o()},function(t){return e.handleApiError(n,t)})})},n.add=function(){return i.Create(0).result.then(function(){return o()})}}]);t=function(n,t,i,r,u,f,e,o){return n.Title="User Management",n.roles=routingConfig.userRolesArray,n.adminRole=routingConfig.userRoles.admin.bitMask,f.getCurrentUser().role.bitMask&routingConfig.userRoles.venueadmin.bitMask&&(n.roles=i("filter")(routingConfig.userRolesArray,{venue_user:!0})),f.getCurrentUser().role.bitMask&routingConfig.userRoles.admin.bitMask&&(n.roles=i("filter")(routingConfig.userRolesArray,{is_admin:!0})),u.query(null,function(t){return n.venues=t}),o>0?r.get({id:o},function(t){return n.user=t}):r["new"](function(t){return n.user=t}),n.save=function(){var i;return n.user.role===routingConfig.userRoles.admin.bitMask&&(n.user.venue_id=null),f.getCurrentUser().venue_id&&o===0&&(n.user.venue_id=f.getCurrentUser().venue_id),i=o===0?r.post(n.user):r.put({id:n.user.id},n.user),i.$promise.then(function(i){return n.user=i,e.showSavedSuccess(),t.close()})["catch"](function(t){return e.handleApiError(n,t)})},n.cancel=function(){return t.dismiss("close")}};n.controller("UserModalCtrl",["$scope","$modalInstance","$filter","UserService","VenueService","Auth","uiHelper","userId",function(n,i,r,u,f,e,o,s){return new t(n,i,r,u,f,e,o,s)}]);n.factory("UserModalProvider",["$modal",function(n){var i;return i={},i.Create=function(i){return n.open({templateUrl:"/views/users/user-modal.html",controller:t,controllerAs:"UserModalCtrl",size:"lg",resolve:{userId:function(){return i}}})},i}])}).call(this);
/*
//# sourceMappingURL=Users.min.js.map
*/